<!DOCTYPE html>
<html lang="en">
<head>
    <title>V-DAO Notary (DApp Kit)</title>
    <script src="https://unpkg.com/@vechain/dapp-kit-ui@latest/dist/index.umd.js"></script>
    <style>
        body { font-family: system-ui, sans-serif; text-align: center; padding: 20px; }
        .container { max-width: 600px; margin: auto; }
        button { background: #007bff; color: white; padding: 10px 15px; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; margin-top: 10px;}
        #result { margin-top: 20px; font-family: monospace; word-break: break-all; }
    </style>
</head>
<body>
    <div class="container">
        <h1>V-DAO Notary Demo</h1>
        <p>This demo uses the official VeChain DApp Kit.</p>
        
        <vdk-button></vdk-button>
        <hr>

        <h3>Step 1: Choose a File</h3>
        <input type="file" id="fileInput">

        <h3>Step 2: Notarize on VeChain</h3>
        <button id="notarizeBtn">Notarize Document</button>

        <div id="result">Your Transaction ID will appear here.</div>
    </div>

    <script>
        // --- THIS IS THE MOST IMPORTANT STEP ---
        // You must get a Project ID from WalletConnect
        const walletConnectProjectId = 'YOUR_WALLET_CONNECT_PROJECT_ID';

        // Configure the DApp Kit
        const dappKit = DAppKitUI.configure({
            node: 'https://testnet.vechain.org/',
            network: 'test',
            walletConnectOptions: {
                projectId: walletConnectProjectId,
                metadata: {
                    name: 'V-DAO Notary',
                    description: 'A simple document notarization tool.',
                    url: window.location.origin,
                    icons: []
                }
            },
            usePersistence: true
        });

        // --- Your Application Logic ---
        document.getElementById('notarizeBtn').addEventListener('click', async () => {
            const fileInput = document.getElementById('fileInput');
            const resultDiv = document.getElementById('result');
            const file = fileInput.files[0];

            if (!file) {
                resultDiv.innerText = 'Error: Please select a file first.';
                return;
            }

            if (!dappKit.wallet.state.address) {
                resultDiv.innerText = 'Error: Please connect your wallet first using the button above.';
                return;
            }

            resultDiv.innerText = 'Working... Please check your wallet to approve.';

            try {
                // 1. Create the hash
                const fileBuffer = await file.arrayBuffer();
                const hashBuffer = await crypto.subtle.digest('SHA-256', fileBuffer);
                const hash = '0x' + Array.from(new Uint8Array(hashBuffer)).map(b => b.toString(16).padStart(2, '0')).join('');

                // 2. Ask the wallet to sign the transaction (using the modern DApp Kit way)
                const { txid } = await dappKit.vendor.sign('tx', [{
                    to: null,
                    value: '0x0',
                    data: hash
                }]).request();

                // 3. Show success
                const explorerUrl = `https://explore-testnet.vechain.org/transactions/${txid}`;
                resultDiv.innerHTML = `âœ… Success! TXID: <a href="${explorerUrl}" target="_blank">${txid}</a>`;

            } catch (error) {
                console.error(error);
                resultDiv.innerText = `Error: ${error.message}`;
            }
        });
    </script>
</body>
</html>
